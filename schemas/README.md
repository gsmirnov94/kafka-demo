# üìã Schema Registry - –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
docker-compose up -d
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã
```bash
cd schemas
./register-user-schema.sh
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Producer
cd ../producer && npm start

# –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ø–∞–ø–∫—É —Å—Ö–µ–º –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ
cd ../schemas
./test-user-schema.sh
```

## üéØ –°—Ö–µ–º–∞ User

### üìä –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ v1
```json
{
  "type": "record",
  "name": "User",
  "namespace": "com.kafka.demo",
  "fields": [
    {"name": "name", "type": "string"},
    {"name": "age", "type": "int"}
  ]
}
```

### üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ v2
```json
{
  "type": "record",
  "name": "User",
  "namespace": "com.kafka.demo",
  "fields": [
    {"name": "name", "type": "string"},
    {"name": "age", "type": "int"},
    {"name": "email", "type": ["null", "string"], "default": null}
  ]
}
```

### üìÅ –§–∞–π–ª—ã —Å—Ö–µ–º—ã
- **`user.avsc`** / **`user-schema.json`** - –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ v1
- **`user-v2.avsc`** / **`user-v2-schema.json`** - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ v2
- **`register-user-schema.sh`** - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã
- **`test-user-schema.sh`** - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã
- **`check-compatibility.sh`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **`example-producer-usage.js`** - –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Producer

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –ó–∞–ø—É—Å–∫ Kafka, Schema Registry –∏ UI
docker-compose up -d
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Å—Ö–µ–º
cd schemas

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã User –≤ Schema Registry
./register-user-schema.sh
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã

```bash
# –ó–∞–ø—É—Å–∫ Producer —Å–µ—Ä–≤–∏—Å–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd ../producer
npm start

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è
cd ../schemas
./test-user-schema.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º
./check-compatibility.sh
```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|----------|
| **Schema Registry** | http://localhost:8081 | API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–∞–º–∏ |
| **Schema Registry UI** | http://localhost:8082 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| **Kafka UI** | http://localhost:8080 | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| **Producer API** | http://localhost:3000 | API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π |
| **Consumer API** | http://localhost:3001 | API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π |

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API

```bash
curl -X POST \
  -H "Content-Type: application/vnd.schemaregistry.v1+json" \
  -d @user-schema.json \
  http://localhost:8081/subjects/user-value/versions
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º—ã

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤
curl http://localhost:8081/subjects

# –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã User
curl http://localhost:8081/subjects/user-value/versions/latest

# –í—Å–µ –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã User
curl http://localhost:8081/subjects/user-value/versions
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Producer

```javascript
// –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Schema Registry
const { sendUserMessage } = require('./example-producer-usage');

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
await sendUserMessage({
  name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
  age: 25
});
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Schema Registry UI
- **URL**: http://localhost:8082
- **–§—É–Ω–∫—Ü–∏–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ö–µ–º

### Kafka UI
- **URL**: http://localhost:8080
- **–§—É–Ω–∫—Ü–∏–∏**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ø–∏–∫–æ–≤, —Å–æ–æ–±—â–µ–Ω–∏–π, —Å—Ö–µ–º

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∞–ª–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**User v1:**
```json
{"name": "–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞", "age": 30}
```

**User v2:**
```json
{"name": "–ü–µ—Ç—Ä –ò–≤–∞–Ω–æ–≤", "age": 28, "email": "petr@example.com"}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Producer API
```bash
curl -X POST http://localhost:3000/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "user-topic",
    "message": {"name": "–ü–µ—Ç—Ä –ò–≤–∞–Ω–æ–≤", "age": 28},
    "key": "user-002"
  }'
```

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **–°—Ö–µ–º–∞ v1 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞** - ID: 2
- **–°—Ö–µ–º–∞ v2 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞** - ID: 3  
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞** - v2 –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å v1
- **Producer API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** - —Å–æ–æ–±—â–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

## üîÑ –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–æ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è –Ω–∞ union —Å null
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

‚ùå **–ó–∞–ø—Ä–µ—â–µ–Ω–æ**:
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è
- –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª–µ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

```bash
curl -X POST \
  -H "Content-Type: application/vnd.schemaregistry.v1+json" \
  -d @user-v2-schema.json \
  http://localhost:8081/compatibility/subjects/user-value/versions/latest
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Schema Registry –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose ps schema-registry

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs schema-registry

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart schema-registry
```

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Avro —Å—Ö–µ–º—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º—ã —Å Producer API
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:3000/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
cd producer
npm start
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Apache Avro Documentation](https://avro.apache.org/docs/current/)
- [Confluent Schema Registry](https://docs.confluent.io/platform/current/schema-registry/index.html)
- [Schema Registry API Reference](https://docs.confluent.io/platform/current/schema-registry/develop/api.html)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Å—Ö–µ–º User –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º, –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ì–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**–£–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–æ Schema Registry! üöÄ** 